<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beautiful Calculator</title>
  <style>
    :root{
      --bg:#0f1724; --panel:#111827; --accent:#10b981; --muted:#94a3b8; --key:#0b1220; --glass: rgba(255,255,255,0.04);
      --radius:14px; --gap:12px; --shadow: 0 6px 18px rgba(2,6,23,0.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:linear-gradient(180deg,var(--bg),#071028); color:#e6eef8; display:grid; place-items:center; padding:28px;
    }

    .wrap{
      width:min(460px,96%); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:20px; padding:18px; box-shadow:var(--shadow);
    }

    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{font-size:1.05rem;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600}

    .screen{background:rgba(255,255,255,0.02);padding:18px;border-radius:12px; margin-bottom:12px; display:flex;flex-direction:column; gap:12px}
    .displayTop{display:flex;justify-content:space-between;font-size:0.9rem;color:var(--muted)}
    .displayMain{font-size:2rem; text-align:right; word-break:break-all}

    .pad{display:grid; grid-template-columns:repeat(4,1fr); gap:var(--gap)}
    button.key{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04)); border: none; padding:18px; font-size:1.05rem; border-radius:12px; cursor:pointer; box-shadow: 0 4px 10px rgba(2,6,23,0.5)}
    button.key.op{background:linear-gradient(180deg,rgba(16,185,129,0.12),rgba(16,185,129,0.06)); color:var(--accent); font-weight:700}
    button.key.wide{grid-column:span 2}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:var(--muted);font-size:0.9rem}

    ul.history{max-height:120px;overflow:auto;margin:0;padding:8px 12px;border-radius:10px;background:rgba(0,0,0,0.04);list-style:none}
    ul.history li{padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.02);font-size:0.9rem}

    .kbd-hint{font-size:0.8rem;color:var(--muted)}

    /* small screens */
    @media (max-width:420px){.displayMain{font-size:1.6rem} button.key{padding:14px;font-size:0.95rem}}

    /* light theme */
    .light{--bg:#f4f7fb; --panel:#ffffff; --accent:#2563eb; --muted:#475569; color:#0b1220}
    .light .wrap{box-shadow: 0 8px 30px rgba(2,6,23,0.06)}
    .light button.key.op{background:linear-gradient(180deg,rgba(37,99,235,0.12),rgba(37,99,235,0.06)); color:var(--accent)}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <h1>Calculator</h1>
      <div class="controls">
        <div class="kbd-hint">Keyboard: 0-9 + - * / Enter = . Backspace</div>
        <button class="btn" id="themeToggle" title="Toggle theme">Toggle</button>
      </div>
    </header>

    <section class="screen">
      <div class="displayTop"><span id="memory">&nbsp;</span><span id="mode">Standard</span></div>
      <div class="displayMain" id="display">0</div>
    </section>

    <section class="pad" role="application" aria-label="Calculator keypad">
      <button class="key" data-action="clear">AC</button>
      <button class="key" data-action="back">âŒ«</button>
      <button class="key" data-action="percent">%</button>
      <button class="key op" data-action="op">/</button>

      <button class="key" data-num="7">7</button>
      <button class="key" data-num="8">8</button>
      <button class="key" data-num="9">9</button>
      <button class="key op" data-action="op">*</button>

      <button class="key" data-num="4">4</button>
      <button class="key" data-num="5">5</button>
      <button class="key" data-num="6">6</button>
      <button class="key op" data-action="op">-</button>

      <button class="key" data-num="1">1</button>
      <button class="key" data-num="2">2</button>
      <button class="key" data-num="3">3</button>
      <button class="key op" data-action="op">+</button>

      <button class="key" data-action="plusminus">+/-</button>
      <button class="key" data-num="0">0</button>
      <button class="key" data-action="dot">.</button>
      <button class="key op wide" data-action="equals">=</button>
    </section>

    <div class="meta">
      <div>History</div>
      <div><button class="btn" id="clearHistory">Clear</button></div>
    </div>
    <ul class="history" id="history"></ul>
  </div>

  <script>
    (function(){
      const app = document.getElementById('app');
      const display = document.getElementById('display');
      const historyEl = document.getElementById('history');
      const themeToggle = document.getElementById('themeToggle');
      const clearHistoryBtn = document.getElementById('clearHistory');

      let expr = '';
      let lastResult = null;
      const MAX_HISTORY = 50;

      function render(){
        display.textContent = expr || String(lastResult ?? 0);
      }

      function pushHistory(input, result){
        if(!input) return;
        const li = document.createElement('li');
        li.textContent = `${input} = ${result}`;
        historyEl.prepend(li);
        while(historyEl.children.length > MAX_HISTORY) historyEl.removeChild(historyEl.lastChild);
      }

      function safeEval(input){
        // Basic sanitization: allow digits, operators, parentheses, decimal point, percent
        if(!/^[0-9+\-*/().%\s]+$/.test(input)) throw new Error('Invalid characters');
        // Convert percent: replace 'number%' with '(number/100)'
        const transformed = input.replace(/(\d+\.?\d*)%/g, '($1/100)');
        // Evaluate using Function to avoid global eval scope
        return Function('"use strict"; return ('+transformed+')')();
      }

      document.querySelectorAll('button.key').forEach(btn => {
        btn.addEventListener('click', ()=>{
          const num = btn.dataset.num;
          const action = btn.dataset.action;
          if(num !== undefined){
            // add digit
            if(expr === '0') expr = num;
            else expr += num;
          } else if(action){
            if(action === 'clear') { expr=''; lastResult=null; display.textContent='0'; }
            else if(action === 'back') { expr = expr.slice(0,-1); }
            else if(action === 'percent') { expr += '%'; }
            else if(action === 'dot') { expr += '.'; }
            else if(action === 'plusminus') {
              // toggle sign of last number
              expr = expr.replace(/(\d+\.?\d*)$/, (m)=>{ return (m.startsWith('-')?m.slice(1):('-'+m)); });
            }
            else if(action === 'op') { expr += btn.textContent.trim(); }
            else if(action === 'equals') {
              if(!expr) return;
              try{
                const result = safeEval(expr);
                pushHistory(expr, result);
                lastResult = result;
                expr = String(result);
              }catch(e){
                lastResult = null;
                expr = '';
                display.textContent = 'Error';
                return;
              }
            }
          }
          render();
        });
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        const allowed = '0123456789+-*/().%'
        if(allowed.includes(e.key)){
          expr += e.key; render(); e.preventDefault();
        } else if(e.key === 'Enter' || e.key === '='){
          document.querySelector('button[data-action="equals"]').click(); e.preventDefault();
        } else if(e.key === 'Backspace'){
          document.querySelector('button[data-action="back"]').click(); e.preventDefault();
        } else if(e.key === 'Escape'){
          document.querySelector('button[data-action="clear"]').click(); e.preventDefault();
        }
      });

      // theme toggle
      themeToggle.addEventListener('click', ()=>{
        document.body.classList.toggle('light');
      });

      clearHistoryBtn.addEventListener('click', ()=>{ historyEl.innerHTML=''; });

      // initial render
      render();

    })();
  </script>
</body>
</html>
